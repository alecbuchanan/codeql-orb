- run:
    name: "Upload CodeQL Results for PR"
    command: |
      repo=$(echo $CIRCLE_REPOSITORY_URL | awk -F'[:/]' '{print $2"/"$3}' | sed 's/\.git$//')
      echo "Extracted Repository: $repo"
      echo $GITHUB_TOKEN | << parameters.codeql_path >> github upload-results \
        --repository=$repo \
        --ref=refs/pull/${CIRCLE_PULL_REQUEST##*/}/head \
        --commit=$CIRCLE_SHA1 \
        --sarif=<< parameters.sarif_file_path >> \
        --github-url=<< parameters.github_url >> \
        --github-auth-stdin
- run:
    name: "Upload CodeQL Results for Branch"
    command: |
      repo=$(echo $CIRCLE_REPOSITORY_URL | awk -F'[:/]' '{print $2"/"$3}' | sed 's/\.git$//')
      echo "Extracted Repository: $repo"
      echo $GITHUB_TOKEN | << parameters.codeql_path >> github upload-results \
        --repository=$repo \
        --ref=refs/heads/${CIRCLE_BRANCH} \
        --commit=$CIRCLE_SHA1 \
        --sarif=<< parameters.sarif_file_path >> \
        --github-url=<< parameters.github_url >> \
        --github-auth-stdin
